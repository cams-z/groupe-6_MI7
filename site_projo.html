<!DOCTYPE html>
<html>
<head>
    <title>Simon</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="/css-site.css">
</head>

<body>

<div class="ui">

    <img src="simon.gif" alt="SIMON LOGO" class="logo">
    <img src="pierre-augustine.gif" alt="PIGEON PARTY" class="pigeon">

    <p id="score" class="bt">Score : 0</p>
    <button onclick="startGame()">START</button>

<!-- Saisie du nom -->
<div id="save" class="save-score" style="display:none;">
    <p class="enter-name-title">Entre ton nom</p>
    <input type="text" id="name" class="name-input" placeholder="Votre nom">
    <button class="validate-btn" onclick="saveScore()">Valider</button>
</div>

    <!-- REGLES  -->
    <details class="collapsible">
        <summary>Règles du jeu</summary>
        <p2>
            Bienvenue au jeu du Simon ! Les règles sont très simples :<br>
            - lorsque le jeu commence, une première lumière va s’allumer ;<br>
            - reproduisez la séquence correctement pour gagner 50 points ;<br>
            - la séquence s’allonge à chaque tour ;<br>
            - le jeu s’arrête dès que vous vous trompez ;<br>
            - plus vous tenez longtemps, plus le score est élevé.
        </p2>
    </details>

        <!-- CLASSEMENT -->
    <details class="collapsible">
        <summary>Classement</summary>
        <ul id="leaderboard"></ul>
    </details>


</div>
<script>
function startGame() {
    fetch("/start");
    document.getElementById("save").style.display = "none";
    document.getElementById("name").value = "";
}

setInterval(() => {
    fetch("/score")
        .then(r => r.text())
        .then(score => {
            document.getElementById("score").innerText = "Score : " + score;
        });

    fetch("/game_over")
        .then(r => r.text())
        .then(state => {
            if (state === "1") {
                document.getElementById("save").style.display = "block";
            }
        });
}, 500);

function saveScore() {
    let name = document.getElementById("name").value;
    if (!name) return;

    fetch("/save_score", {
        method: "POST",
        headers: {"Content-Type": "application/x-www-form-urlencoded"},
        body: "name=" + encodeURIComponent(name)
    }).then(() => {
        document.getElementById("save").style.display = "none";
        loadScores();
    });
}

function loadScores() {
    fetch("/scores")
        .then(r => r.json())
        .then(data => {
            let ul = document.getElementById("leaderboard");
            ul.innerHTML = "";
            data.forEach((e, i) => {
                ul.innerHTML += `<li class="leaderboard-item">${i + 1}. ${e[0]} - ${e[1]}</li>`;
            });
        });
}

loadScores();
</script>


</body>
</html>
